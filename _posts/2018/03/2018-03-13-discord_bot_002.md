---
layout: post
title:  "Discord botã®ä½œã‚Šæ–¹ 2"
date:   2018-03-13 4:00:00 +0900
categories: discord
---

botã®ä½œã‚Šæ–¹ã¯[Discord botã®ä½œã‚Šæ–¹ 1][lnk-01]ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚  

### Node.jsã‚’ç”¨æ„ã™ã‚‹
Node.jsã®å°Žå…¥æ–¹æ³•ã¯ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚  
- [windowsã«Node.jsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹][lnk-02]

### Discord.jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

{% highlight shell %}
> npm install discord.js

+ discord.js@11.3.2
added 8 packages in 1.168s
{% endhighlight %}


### å˜ç´”ãªå‹•ä½œã‚’ã™ã‚‹botã‚’ä½œæˆ
`!ping`ã¨æ‰“ã¡è¾¼ã‚“ã ã‚‰`pong!`ã¨è¿”ã™bot
{% highlight js %}
const Discord = require('discord.js');
const client = new Discord.Client();

client.on('ready', () => {
	console.log('Login!!');
});

client.on('message', (message) => {
	if (message.content.startsWith('!ping')) {
		message.channel.send('pong!');
	}
});

client.login('ã“ã“ã«Tokenã‚’å…¥åŠ›');
{% endhighlight %}

![img-05][img-05]  
ã“ã‚Œã§å®Œæˆã§ã™ï¼  

### ãŠã¾ã‘

è¨˜äº‹ã‚’æ›¸ãã«è‡³ã£ãŸã‚³ãƒ¼ãƒ‰ã§ã™ãƒ»ãƒ»ãƒ»  
Discordã§ðŸ“Œã‚’ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’DMã§ä¿å­˜ã™ã‚‹ãƒ¡ãƒ¢å¸³botã§ã™  
{% highlight js %}
const Discord = require('discord.js');
const client = new Discord.Client();
const botToken = "ã“ã“ã«ãƒˆãƒ¼ã‚¯ãƒ³";
const pinEmoji = 'ðŸ“Œ';

client.on('ready', () => {
	console.log('I am ready!');
});

client.on('messageReactionAdd', async (messageReaction, user) => {
	if (messageReaction.emoji.name !== pinEmoji) {
		return;
	}
	if (!user.dmChannel) {
		await user.createDM();
	}

	let time = new Date(messageReaction.message.createdTimestamp).toISOString().replace(/T/, ' ').replace(/\..+/, '');
	let info = time + '(UTC)' + ' <@' + messageReaction.message.author.id + '> ' + 'in <#' + messageReaction.message.channel.id + '>';
	let message = '[' + info + '] ' + messageReaction.message.content;
	user.dmChannel.send(message);
	let attachments = [];
	for (const [key, attachment] of messageReaction.message.attachments) {
		attachments.push(attachment.url);
	}
	user.dmChannel.send(message, {files: attachments});
});

client.login(botToken);
{% endhighlight %}


[lnk-01]: {{baseurl}}/discord/2018/03/13/discord_bot_001.html
[lnk-02]: https://qiita.com/Masayuki-M/items/840a997a824e18f576d8

[img-05]: {{site.baseurl}}/images/2018/03/discord-bot-05.png
